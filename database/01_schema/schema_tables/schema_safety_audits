create table public.safety_audits (
  id uuid not null default gen_random_uuid (),
  audit_number character varying(50) not null,
  project_id uuid null,
  main_area_id uuid null,
  sub_area1_id uuid null,
  sub_area2_id uuid null,
  main_area character varying null,
  sub_area1 character varying null,
  sub_area2 character varying null,
  specific_location text null,
  area_info jsonb null,
  audit_date date not null default CURRENT_DATE,
  auditor_id uuid null,
  number_of_personnel integer null,
  total_score numeric(5, 2) null,
  max_possible_score numeric(5, 2) null,
  weighted_average numeric(5, 2) null,
  percentage_score numeric(5, 2) null,
  status character varying(20) null default 'draft'::character varying,
  reviewed_by uuid null,
  reviewed_at timestamp with time zone null,
  review_notes text null,
  created_by uuid null,
  created_at timestamp with time zone null default now(),
  updated_at timestamp with time zone null default now(),
  submitted_at timestamp with time zone null,
  audit_criteria_rev jsonb null default '{}'::jsonb,
  category_scores jsonb null default '{}'::jsonb,
  activity text null,
  constraint safety_audits_pkey primary key (id),
  constraint safety_audits_audit_number_key unique (audit_number),
  constraint safety_audits_created_by_fkey foreign KEY (created_by) references users (id) on delete set null,
  constraint safety_audits_main_area_id_fkey foreign KEY (main_area_id) references main_areas (id),
  constraint safety_audits_project_id_fkey foreign KEY (project_id) references projects (id) on delete RESTRICT,
  constraint safety_audits_reviewed_by_fkey foreign KEY (reviewed_by) references users (id) on delete set null,
  constraint safety_audits_sub_area2_id_fkey foreign KEY (sub_area2_id) references sub_areas_2 (id),
  constraint safety_audits_auditor_id_fkey foreign KEY (auditor_id) references users (id) on delete set null,
  constraint safety_audits_sub_area1_id_fkey foreign KEY (sub_area1_id) references sub_areas_1 (id),
  constraint safety_audits_status_check check (
    (
      (status)::text = any (
        (
          array[
            'draft'::character varying,
            'submitted'::character varying,
            'reviewed'::character varying,
            'approved'::character varying,
            'rejected'::character varying
          ]
        )::text[]
      )
    )
  ),
  constraint safety_audits_number_of_personnel_check check ((number_of_personnel >= 0)),
  constraint safety_audits_scores_check check (
    (
      (total_score >= (0)::numeric)
      and (max_possible_score >= (0)::numeric)
      and (weighted_average >= (0)::numeric)
      and (weighted_average <= (3)::numeric)
      and (percentage_score >= (0)::numeric)
      and (percentage_score <= (100)::numeric)
    )
  )
) TABLESPACE pg_default;

create index IF not exists idx_safety_audits_project on public.safety_audits using btree (project_id) TABLESPACE pg_default;

create index IF not exists idx_safety_audits_date on public.safety_audits using btree (audit_date desc) TABLESPACE pg_default;

create index IF not exists idx_safety_audits_status on public.safety_audits using btree (status) TABLESPACE pg_default;

create index IF not exists idx_safety_audits_auditor on public.safety_audits using btree (auditor_id) TABLESPACE pg_default;

create index IF not exists idx_safety_audits_created on public.safety_audits using btree (created_at desc) TABLESPACE pg_default;

create index IF not exists idx_safety_audits_main_area on public.safety_audits using btree (main_area_id) TABLESPACE pg_default;

create index IF not exists idx_safety_audits_sub_area1 on public.safety_audits using btree (sub_area1_id) TABLESPACE pg_default;

create index IF not exists idx_safety_audits_sub_area2 on public.safety_audits using btree (sub_area2_id) TABLESPACE pg_default;